{% extends 'template.html' %}

{% block title %}ScrapInfo{% endblock %}
{% block head %}
    <script>
      function active(sectionName, load=false) {
        const numsection = Array.from(document.querySelectorAll('.section-name')).indexOf(sectionName);
        const section = document.querySelectorAll('.section')[numsection];
        if (section.className.includes('active')) {
          section.querySelector('.elements').style.display = 'none';
          section.querySelector('h1 i').className = 'fa fa-angle-down';
          section.className = 'section';
        } else {
          section.querySelector('.elements').style.display = '';
          if (!load) { window.scrollTo(0, sectionName.getBoundingClientRect().y+window.pageYOffset-150) }
          section.querySelector('h1 i').className = 'fa fa-angle-up';
          section.className = 'section active';
        }
      }
    </script>
{% endblock %}
{% block main %}
      <div class="infos {{ info.img.class }}">
        <div class="info-img {{ info.img.class }}" data-bg="{{ info.img.link }}" style="background-image: url('{{ info.img.link }}');"></div>
        <h1 class="title"> {{ info.title }} </h1>
        <div class="infos-infos">
          <span class="info-infos"> {{ info.infos|join:' | ' }} </span>
          <ul class="genres scrollbar">
            {% for genre in info.genres %}
              <li class="genre">
                {% if genre.link %}
                  <a href="/ScrapGenre{{ app }}/?Site={{ site }}&url={{ genre.link }}" target="_blank">{{ genre.name }}</a>
                {% else %}
                  {{ genre.name }}
                {% endif %}
              </li>
            {% endfor %}
          </ul>
          <p class="scrollbar"> &nbsp;&nbsp;&nbsp;&nbsp; {{ info.desc }} </p>
        </div>
      </div>
        <ul class="sections">
          {% for section in info.sections %}
            <div class="section">
              <h1 class="section-name" onclick="active(this);">{{ section.name }}<i class="fa fa-angle-down"></i></h1>
              <ul class="elements" style="display: none;">
                {% for ep in section.elements %}
                  <li class="element">
                    <a href="/Scrap{{ ep.type }}{{ app }}/?Site={{ site }}&url={{ ep.link }}" target="_blank">
                      {% if ep.img %}
                        <img class="element-img {{ ep.img.class }}" data-src="{{ ep.img.link }}">
                        <h4>{{ ep.title }}</h4>
                      {% else %}
                        <div><h4>{{ ep.title }}</h4></div>
                      {% endif %}
                    </a>
                  </li>
                {% endfor %}
              </ul>
            </div>
          {% empty %}
          <ul class="elements">
            {% for ep in info.elements %}
              <li class="element">
                <a href="/Scrap{{ ep.type }}{{ app }}/?Site={{ site }}&url={{ ep.link }}" target="_blank">
                  {% if ep.img %}
                    <img class="element-img {{ ep.img.class }}" data-src="{{ ep.img.link }}" onerror="imgError(this)">
                    <h4>{{ ep.title }}</h4>
                  {% else %}
                    <div><h4>{{ ep.title }}</h4></div>
                  {% endif %}
                </a>
              </li>
            {% endfor %}
          </ul>
          {% endfor %}
        </ul>
        <script>active(document.querySelector('.section-name'), true);</script>
{% endblock %}